<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Helix — Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
        body {
            font-family: system-ui, sans-serif;
            background: #0b0b0b;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .box {
            background: #161616;
            padding: 2rem;
            width: 320px;
            border-radius: 10px;
        }

        input,
        button {
            width: 100%;
            margin-top: 0.7rem;
            padding: 0.6rem;
            border-radius: 6px;
            border: none;
        }

        input {
            background: #222;
            color: #fff;
        }

        button {
            background: #4f46e5;
            color: white;
            cursor: pointer;
        }

        button.secondary {
            background: #333;
        }

        .hidden {
            display: none;
        }

        .status {
            margin-top: 1rem;
            font-size: 0.9rem;
            opacity: 0.85;
        }
    </style>
</head>

<body>

    <div class="box">

        <!-- LOGIN / SIGNUP -->
        <div id="auth">
            <h2>Helix Account</h2>

            <input id="email" type="email" placeholder="Email" />
            <input id="password" type="password" placeholder="Password" />

            <button onclick="login()">Log in</button>
            <button class="secondary" onclick="signup()">Sign up</button>

            <div class="status" id="authStatus"></div>
        </div>

        <!-- ACCOUNT -->
        <div id="account" class="hidden">
            <h2>Welcome</h2>

            <p id="userEmail"></p>
            <p id="userRole"></p>

            <button onclick="logout()">Log out</button>
        </div>

    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // ===============================
        // CONFIG — CHANGE THESE
        // ===============================
        const SUPABASE_URL = "https://YOUR_PROJECT_ID.supabase.co";
        const SUPABASE_ANON_KEY = "YOUR_PUBLIC_ANON_KEY";

        const supabaseClient = supabase.createClient(
            SUPABASE_URL,
            SUPABASE_ANON_KEY
        );

        // ===============================
        // ELEMENTS
        // ===============================
        const authBox = document.getElementById("auth");
        const accountBox = document.getElementById("account");
        const authStatus = document.getElementById("authStatus");

        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");

        const userEmailText = document.getElementById("userEmail");
        const userRoleText = document.getElementById("userRole");

        // ===============================
        // AUTH FUNCTIONS
        // ===============================
        async function signup() {
            const email = emailInput.value;
            const password = passwordInput.value;

            const { error } = await supabaseClient.auth.signUp({
                email,
                password
            });

            authStatus.textContent = error
                ? error.message
                : "Check your email to confirm signup.";
        }

        async function login() {
            const email = emailInput.value;
            const password = passwordInput.value;

            const { error } = await supabaseClient.auth.signInWithPassword({
                email,
                password
            });

            authStatus.textContent = error
                ? error.message
                : "Logged in.";

            loadUser();
        }

        async function logout() {
            await supabaseClient.auth.signOut();
            showAuth();
        }

        // ===============================
        // USER STATE
        // ===============================
        async function loadUser() {
            const { data } = await supabaseClient.auth.getUser();
            const user = data.user;

            if (!user) {
                showAuth();
                return;
            }

            userEmailText.textContent = `Email: ${user.email}`;

            // Fetch role from profiles table
            const { data: profile } = await supabaseClient
                .from("profiles")
                .select("role")
                .eq("id", user.id)
                .single();

            userRoleText.textContent =
                profile?.role === "admin"
                    ? "Role: Admin"
                    : "Role: User";

            showAccount();
        }

        function showAuth() {
            authBox.classList.remove("hidden");
            accountBox.classList.add("hidden");
        }

        function showAccount() {
            authBox.classList.add("hidden");
            accountBox.classList.remove("hidden");
        }

        // ===============================
        // INIT
        // ===============================
        loadUser();
    </script>

</body>

</html>